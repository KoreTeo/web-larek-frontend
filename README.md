# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс для модели данных товара
```
export interface IProduct {
  id: string;
  title: string;
  category: string;
  image: string;
  price: number;
  description: string;
}
```
Интерфейс для модели данных заказа
```
export interface IOrder{
  items: string[];
  total: number;
}
```
Интерфейс для обработки ответа при оформлении заказа
```
export interface IOrderSuccess {
  items: string[];
  total: number;
  address: string;
  payment: PaymentMethod;
  email: string;
	phone: string;
}
```
Тип данных для обработки ошибок в формах
```
export type FormErrors = Partial<Record<keyof Order, string>>;
```
Словарь возможных методов оплаты
```
export enum PaymentMethod {
  online,
  onReceipt
}
```
Словарь возможных категорий товаров
```
export enum ProductCategory {
  softskill = 'софт-скил',
  hardskill = 'хард-скил',
  other = 'другое',
  additional = 'дополнительное',
  button = 'кнопка'
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.\
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

#### Базовый Класс "Component"
Абстрактный класс, служит в качестве базового компонента для работы с DOM. 

- `toggleClass` - переключает CSS-класс;
- `setText` - установливает текстовое содержимое;
- `setDisabled` - изменяет статус блокировки;
- `setHidden` - скрывает элемент;
- `setVisible` - показывает элемент;
- `setImage` - установливает изображение с алтернативным текстом;
- `render` - возвращает корневой DOM-элемент.

### Слой данных

#### Класс IAppState
Класс отвечает за управление состоянием приложения, включая каталог продуктов, корзину, текущий заказ и ошибки формы.\
В полях класса хранятся следующие данные:
- `_catalog: Product[]` - массив объектов товаров
- `_selectedProduct: Product | null` - товар, выбранный для просмотра в модальной окне
- `_order: Order | null` - текущий заказ.
- `_basket: Product[] | null` - корзина с добавленными товарами
- `events: IEvents` - экземпляр класса `EventEmitter` для инициации событий при изменении данных.

Так же класс обладает набором методов:
- `selectProduct(id: string): void` - метод, меняющий выбранный товар, в случае открытия его описания
- `addProduct(id: string): void` - отвечает за добавление товара в корзину
- `removeProduct(id: string): void` - отвечает за удаление товара из корзины
- `clearBasket(): void` - отвечает за очистку корзины
- `clearOrder(): void` - очищает данные заказа;
- `getBasketTotal(): number` - позволяет получить количество товаров в корзине
- `validateOrder(data: FormErrors): boolean` - отвечает за валидацию данных в заказе
- `setCatalog(): Promise<Product[]>` - устанавливает каталог продуктов
- `orderProduct(): Promise<OrderSuccess>` - отвечает за оформление заказа с его последующей отправкой на сервер

### Слой представления

#### Класс Modal 
Этот класс представляет модальное окно, наследуемое от базового класса Component.\
Поля класса:
- `_closeButton` - кнопка для закрытия модального окна;
- `_content` - контейнер для содержимого окна.\
Методы: 
- `set content(value: HTMLElement)` - задает содержимое модального окна; 
- `openModal(): void` - открывает модальное окно, добавляя CSS-класс и генерируя событие открытия.
- `closeModal(): void` - закрывает модальное окно, удаляя CSS-класс, очищая содержимое и генерируя событие закрытия.
- `render(element: HTMLElement): void` - отображает модальное окно.

#### Класс Basket
Этот класс, наследующий от базового `Component<IBasketView>`, управляет отображением корзины с добавленными товарами.
Методы:
- `total` - обновляет текст элемента, отображающий общую стоимость товаров в корзине.;
- `items` - обновляет содержимое корзины;

#### Класс Form
Form<T>, расширяющий `Component<IFormState>`, предоставляет инструменты для работы с HTML-формами.
Этот класс управляет состоянием формы, обработкой ввода и отправки, а также обработкой ошибок.\
Поля класса:
- `_submit: HTMLButtonElement` - кнопка "Далее".
- `_errors: HTMLElement` - элемент для отображения ошибок формы.\
Методы:
- `onInputChange` - обрабатывает изменения ввода в форме и генерирует событие с информацией о поле и его новом значении;
- `valid` - устанавливает состояние валидности формы. Активирует или деактивирует кнопку отправки;
- `setValid` - изменяет состояние кнопки "Далее";
- `errors` -  выводит текст ошибок в элементе _errors;
- `render` - обновляет отображение формы в соответствии с текущим состоянием, проверяет валидность и отображает ошибки.

#### Класс Order
Order, наследуемый от Form<TPaymentForm>, представляет форму заказа с выбором способа оплаты и адреса доставки.\
Поля класса:
- `buttonOnline` - кнопка для выбора онлайн-оплаты;
- `buttonOnReceipt` - кнопка для выбора оплаты при получении;
- `_address` - поле ввода адреса доставки.
Конструктор: Инициализирует форму, добавляет обработчики событий для кнопок выбора способа оплаты.\
Методы:
- `set address` - устанавливает значение адреса доставки;
- `togglePayment` - переключает активное состояние кнопок выбора способа оплаты;
- `resetButtonState` - сбрасывает состояние кнопок выбора способа оплаты.

#### Класс Contacts
Класс Contacts наследуется от класса Form<TContactsForm> и представляет форму для ввода контактной информации (email и телефон).\
Поля класса: 
- `_email` - поле ввода email;
- `_phone` - поле ввода номера телефона.\
Методы:
Наследует от `Form<TContactsForm>`.

#### Класс Success
Success, наследуемый от Component<ISuccess>, предназначен для отображения сообщения об успешном выполнении заказа.\
Поля класса:
- `_close` - кнопка для закрытия сообщения об успехе;
- `_description` - элемент для отображения описания успешного заказа.\
Методы:
Наследует методы от Component.

#### Класс Page
Класс, наследуемый от базового Component.\
Поля:
- `_counter` - счетчик товаров в корзине;
- `_catalog` - каталог товаров;
- `_wrapper` - обертка страницы;
- `_basket` - элемент корзины.\
Методы:
- `set catalog` - устанавливает содержимое элемента _catalog;
- `set counter` - устанавливает значение элемента _counter;
- `set locked` - управляет классом page__wrapper_locked у элемента _wrapper.

#### Класс Card
Класс, наследуемый от `Component<IProduct>`, используемый в каталоге.\
Имеет следующие поля:
- `_category` - категория;
- `_image` - изображение;
- `_category` - категория;
- `_price` - цена;

#### Класс BasketCard
Класс BasketCard наследует свойства и методы от класса Card, используется при отображении товаров в корзине.\
Поля:
- `_index` - поле, представляющее индекс элемента корзины;
- `_deleteButton` - защищенное свойство типа HTMLButtonElement, представляющее кнопку удаления элемента корзины.\
Методы:
Наследует от Component.

#### События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами моделями данных) - используемые в index.ts, реализуя Presenter

- `items:changed` - обновление списка продуктов;
- `card:select` - открытие карточки и блокировка интерфейса;
- `card:addToBasket` - добавление карточки в корзину;
- `basket:open` - открытие корзины;
- `basket:changed` - обновление интерфейса корзины;
- `order:open` - открытие формы заказа;
- `order:changed` - изменения в заказе;
- `order.address:change` - изменение адреса
- `/contacts\.(phone|email):change/` - изменение контактов
- `formErrors:changed` - ошибки формы
- `order:submit` - подтверджение формы оплаты;
- `contacts:submit` - подтверджение формы контактов;